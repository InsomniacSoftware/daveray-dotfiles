#!/bin/sh

if [ -f nrepl.sh ]; then
  NREPL_PORT=`unused-port`
  gvim -c "let nreplPort=\"$NREPL_PORT\"" $* &
  ./nrepl.sh $NREPL_PORT
elif [ -f project.clj ]; then
  gvim $* &
  lein repl
elif [ -f build.gradle ]; then
  # First look in parent directories
  if [ -z $GRADLEW ]; then
    GRADLEW=`upfind -name gradlew`
  fi

  # Next look on path
  if [ -z $GRADLEW ]; then
    GRADLEW=`which gradlew`
  fi

  if [ -n $GRADLEW ]; then
    NREPL_PORT=9999 #`unused-port`
    gvim -c "let nreplPort=\"$NREPL_PORT\"" $* &
    echo "executing: $GRADLEW nrepl -PnreplPort=$NREPL_PORT"
    $GRADLEW nrepl -PnreplPort=$NREPL_PORT
  else
    echo "Didn't fine gradlew"
  fi
else
  echo "I'm at a loss"
fi
# vim:ft=sh
